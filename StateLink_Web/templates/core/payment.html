{% extends 'base.html' %}

{% block title %}Payment - Business Compliance Organization LLC{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card">
                <div class="card-header">
                    <h2 class="mb-0">Payment</h2>
                </div>
                <div class="card-body">
                    <!-- Business Information -->
                    <div class="mb-4">
                        <h4>Business Information</h4>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Business Name:</strong> {{ business.name }}</p>
                                <p><strong>Reference Number:</strong> {{ business.reference_number }}</p>
                                <p><strong>State:</strong> {{ business.state_code }}</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Business Type:</strong> {{ business.get_business_type_display }}</p>
                                <p><strong>Principal Address:</strong> {{ business.address }}{% if business.address2 %}, {{ business.address2 }}{% endif %}, {{ business.city }}, {{ business.state_code }} {{ business.zip_code }}</p>
                                <p><strong>Registered Agent:</strong> {{ business.registered_agent }}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Service Breakdown -->
                    <div class="mb-4">
                        <h4>Service Breakdown</h4>
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Service</th>
                                    <th>Price</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for service in bundled_services %}
                                <tr>
                                    <td>{{ service.name }}</td>
                                    <td>${{ service.price }}</td>
                                </tr>
                                {% endfor %}
                                {% for request in individual_services %}
                                <tr>
                                    <td>{{ request.get_request_type_display }}</td>
                                    <td>${{ request.price }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                            <tfoot>
                                {% if show_discount %}
                                <tr>
                                    <th>Subtotal</th>
                                    <th>${{ subtotal }}</th>
                                </tr>
                                <tr class="table-success">
                                    <th>Compliance Bundle Discount</th>
                                    <th>-${{ discount }}</th>
                                </tr>
                                {% endif %}
                                <tr>
                                    <th>Total</th>
                                    <th>${{ total_price }}</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>

                    <!-- Agreement Section -->
                    <div class="mb-4">
                        <h4>Agreement and Signature</h4>
                        
                        <div class="mb-3">
                            <p class="small text-muted">
                                With my digital signature, (i) I represent and warrant that all of the information provided is accurate and complete; 
                                (ii) I agree that I have carefully read and agree to be bound by the Terms of Service, Refund Policy, and Privacy Policy (see below) 
                                and (iii) I have read and understand that I am hereby authorizing Business Compliance Organization NC as a "Third Party Designee" 
                                to process the requested services on my behalf using the information I provided.
                            </p>
                        </div>

                        <div class="mb-3">
                            <p class="small text-muted">
                                I agree to the terms & conditions and authorize this payment to Business Compliance Organization NC. 
                                I hereby certify that the information provided is correct and that I am authorized to conduct this transaction.
                            </p>
                        </div>

                        {% if has_labor_law_poster %}
                        <div class="mb-3">
                            <p class="small text-muted">
                                I understand that the labor law posters provided with this order will reflect the most current laws at the time of purchase 
                                and that this is a one-time transaction, not a subscription service. I acknowledge that I will not receive automatic updates 
                                regarding changes to the laws, and it is my sole responsibility to stay informed of any mandatory updates and ensure that 
                                the posters are updated as needed to maintain compliance.
                            </p>
                        </div>
                        {% endif %}

                        <div class="mb-3">
                            <p class="small text-muted">
                                I have read, understand, and agree to be bound by the 
                                <a href="#" data-bs-toggle="modal" data-bs-target="#refundPolicyModal">Refund Policy</a>, 
                                <a href="#" data-bs-toggle="modal" data-bs-target="#privacyPolicyModal">Privacy Policy</a>, and 
                                <a href="#" data-bs-toggle="modal" data-bs-target="#termsOfServiceModal">Terms of Service</a>. 
                                I am aware that all payments are final, with the exceptions specified in the return policy.
                            </p>
                        </div>

                        <form method="post">
                            {% csrf_token %}
                            
                            <div class="form-check mb-3">
                                <input type="checkbox" 
                                       name="{{ form.agrees_to_terms_digital_signature.name }}"
                                       id="{{ form.agrees_to_terms_digital_signature.id_for_label }}"
                                       class="form-check-input"
                                       {% if form.agrees_to_terms_digital_signature.value %}checked{% endif %}>
                                <label class="form-check-label" for="{{ form.agrees_to_terms_digital_signature.id_for_label }}">
                                    I've read and accept the terms and conditions.
                                </label>
                                {% if form.agrees_to_terms_digital_signature.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.agrees_to_terms_digital_signature.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            <div class="mb-3">
                                <label for="{{ form.client_signature_text.id_for_label }}" class="form-label">Client Agreement & Signature</label>
                                <input type="text" 
                                       name="{{ form.client_signature_text.name }}"
                                       id="{{ form.client_signature_text.id_for_label }}"
                                       class="form-control"
                                       value="{{ form.client_signature_text.value }}"
                                       placeholder="Type your full name to sign">
                                {% if form.client_signature_text.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.client_signature_text.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                                <div class="alert alert-info small mt-2">
                                    By typing your name above, you are digitally signing this application and affirming all statements and agreements.
                                </div>
                            </div>

                            <!-- Payment Widget Placeholder -->
                            <div class="mb-4">
                                <h4>Payment Method</h4>
                                <div class="alert alert-secondary">
                                    <strong>Payment Widget Placeholder:</strong><br>
                                    <!-- Insert your payment provider's embed code or widget here -->
                                    <div id="payment-widget-placeholder" style="height: 120px; display: flex; align-items: center; justify-content: center; background: #f8f9fa; border: 1px dashed #ccc;">
                                        <span class="text-muted">[Payment provider widget goes here]</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Pay Now Button -->
                            <div class="d-grid">
                                <button type="submit" class="btn btn-success btn-lg">Pay Now</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 